<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Critical Path</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100..900&display=swap" rel="stylesheet" />
  <script src="https://unpkg.com/cytoscape@3.26.0/dist/cytoscape.min.js"></script>
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Montserrat", sans-serif;
      background: black;
      color: white;
    }

    header {
      margin: auto;
      display: flex;
      border-radius: 10px;
      border: 1px solid white;
      background-color: white;
      width: 300px;
      margin-top: 20px;
      justify-content: center;
      gap: 20px;
    }

    a {
      text-decoration: none;
      color: black;
      padding: 5px 0;
    }

    a:hover {
      font-size: 17px;
    }

    .title {
      color: white;
      text-align: center;
      font-size: 100px;
      font-weight: 800;
      margin-top: 100px;
    }

    .containerone {
      display: flex;
    }

    .leftone {
      width: 60%;
      padding-left: 5%;
    }

    .rightone {
      width: 40%;
    }

    h2 {
      color: white;
      padding-left: 3%;
      font-weight: 200;
    }

    .imgone {
      width: 90%;
      padding-right: 2%;
      padding-left: 10%;
      padding-top: 3%;
      height: 250px;
      object-fit: cover;
    }

    .imgtwo {
      padding: 5% 0 5% 5%;
      width: 95%;
      height: 350px;
      object-fit: cover;
    }

    .center {
      padding: 5% 5% 100px 5%;
      background-color: #d8d8c6;
      color: black;
    }

    h1 {
      font-size: 50px;
      color: black;
      padding-left: 2%;
    }

    ol {
      font-size: 20px;
      color: black;
    }

    .cc {
      padding-left: 2%;
      font-weight: 200;
    }

    .contoh {
      width: 100%;
    }

    /* === Simulator Styles === */
    #simulator-container {
      padding: 50px 5%;
      background: #121212;
    }

    #cy-toolbar {
      background: #1e1e1e;
      color: white;
      padding: 12px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      border-radius: 6px 6px 0 0;
      font-family: "Montserrat", sans-serif;
    }

    #cy {
      width: 100%;
      height: 600px;
      background: #1a1a1a;
      cursor: grab;
      border-radius: 0 0 6px 6px;
    }

    button {
      background: #3b82f6;
      border: none;
      padding: 8px 14px;
      color: #fff;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 500;
    }

    button:hover {
      background: #2563eb;
    }

    #info {
      margin-left: auto;
      font-size: 14px;
      color: #ccc;
    }

    .modal {
      display: none;
      position: fixed;
      top: 30%;
      left: 50%;
      transform: translate(-50%, -30%);
      background: #252525;
      color: #fff;
      padding: 20px;
      border: 1px solid #444;
      z-index: 1000;
      width: 300px;
      border-radius: 8px;
      box-shadow: 0 0 20px rgba(0,0,0,0.8);
    }

    .modal h3 {
      margin-top: 0;
      font-size: 18px;
    }

    .modal input {
      width: 100%;
      margin-bottom: 10px;
      padding: 8px;
      background: #1e1e1e;
      border: 1px solid #555;
      color: #fff;
      border-radius: 4px;
    }

    .modal-buttons {
      text-align: right;
    }

    .modal-buttons button {
      background: #3b82f6;
      margin-left: 10px;
    }

    .modal-buttons button:hover {
      background: #2563eb;
    }
  </style>
</head>
<body>

  <header>
    <a href="index.html">Kanban</a>
    <a href="criticalpath.html">Critical Path</a>
  </header>

  <p class="title">Critical Path</p>

  <div class="containerone">
    <div class="leftone">
      <h2>
        Metode jalur kritis (CPM) adalah teknik di mana Anda mengidentifikasi tugas yang diperlukan untuk penyelesaian proyek dan menentukan fleksibilitas penjadwalan. Jalur kritis dalam manajemen proyek merupakan rangkaian aktivitas terpanjang yang harus diselesaikan tepat waktu agar proyek selesai. Penundaan dalam tugas kritis akan menunda bagian lain dalam proyek. CPM fokus mencari tugas terpenting dalam linimasa proyek, mengidentifikasi dependensi tugas, dan menghitung durasi tugas.
      </h2>
    </div>
    <div class="rightone">
      <img src="criticalpath.png" class="imgone">
    </div>
  </div>

  <img src="criticalpathh.png" class="imgtwo">

  <div class="center">
    <h1>Karakteristik</h1>
    <div class="cc">
      <ol type="1">
        <li>Penentuan early start dan late finish: Menggunakan perhitungan Forward Pass dan Backward Pass.</li>
        <li>Mengoptimalkan jadwal proyek: Mengidentifikasi tugas-tugas yang harus diprioritaskan dan menambah sumber daya pada tugas kritis (Crashing).</li>
        <li>Berbasis network diagram: Menunjukkan ketergantungan antar tugas dengan nodes dan arrows.</li>
        <li>Deterministik: CPM paling efektif untuk proyek dengan durasi tugas yang sudah diketahui sebelumnya.</li>
      </ol>
    </div>
  </div>

  <img src="contoh.png" class="contoh">

  <!-- === Simulator Start === -->
  <div id="simulator-container">
    <div id="cy-toolbar">
      <button onclick="addTask()">‚ûï Add Task</button>
      <button onclick="startConnect()">üîó Connect Tasks</button>
      <button onclick="calculateCriticalPath()">üîç Critical Path</button>
      <div id="info">Critical Path: </div>
    </div>
    <div id="cy"></div>
  </div>

  <!-- Modal -->
  <div id="editModal" class="modal">
    <h3>Edit Task</h3>
    <input type="text" id="taskName" placeholder="Task Name">
    <input type="date" id="taskDue">
    <div class="modal-buttons">
      <button onclick="closeModal()">Cancel</button>
      <button onclick="saveTask()">Save</button>
    </div>
  </div>

  <!-- Script -->
  <script>
    let cy = cytoscape({
      container: document.getElementById('cy'),
      style: [
        {
          selector: 'node',
          style: {
            'background-color': '#3b82f6',
            'label': 'data(label)',
            'color': '#fff',
            'text-valign': 'center',
            'text-halign': 'center',
            'text-wrap': 'wrap',
            'font-size': '12px',
            'padding': '10px',
            'shape': 'roundrectangle',
            'border-color': '#60a5fa',
            'border-width': 2
          }
        },
        {
          selector: 'edge',
          style: {
            'width': 3,
            'line-color': '#888',
            'target-arrow-color': '#888',
            'target-arrow-shape': 'triangle'
          }
        },
        {
          selector: '.critical',
          style: {
            'line-color': '#ef4444',
            'target-arrow-color': '#ef4444'
          }
        }
      ],
      layout: { name: 'preset' }
    });

    let taskCounter = 1;
    let connecting = false;
    let sourceNode = null;
    let selectedNode = null;

    function addTask() {
      const id = 't' + taskCounter++;
      cy.add({
        group: 'nodes',
        data: { id: id, label: 'Task ' + id },
        position: {
          x: Math.random() * 800 + 100,
          y: Math.random() * 400 + 100
        }
      });
    }

    function startConnect() {
      connecting = true;
      alert('Click on source node, then target node');
    }

    cy.on('tap', 'node', function(evt) {
      if (connecting) {
        if (!sourceNode) {
          sourceNode = evt.target;
        } else {
          const targetNode = evt.target;
          cy.add({
            group: 'edges',
            data: { source: sourceNode.id(), target: targetNode.id() }
          });
          sourceNode = null;
          connecting = false;
        }
      } else {
        selectedNode = evt.target;
        document.getElementById('taskName').value = selectedNode.data('label');
        document.getElementById('taskDue').value = selectedNode.data('due') || '';
        document.getElementById('editModal').style.display = 'block';
      }
    });

    function closeModal() {
      document.getElementById('editModal').style.display = 'none';
    }

    function saveTask() {
      const name = document.getElementById('taskName').value;
      const due = document.getElementById('taskDue').value;
      if (selectedNode) {
        selectedNode.data('label', name);
        selectedNode.data('due', due);
      }
      closeModal();
    }

    function calculateCriticalPath() {
      // Reset styles
      cy.edges().removeClass('critical');

      const nodes = cy.nodes();
      const edges = cy.edges();
      const adj = {};
      const inDeg = {};

      nodes.forEach(n => {
        adj[n.id()] = [];
        inDeg[n.id()] = 0;
      });

      edges.forEach(e => {
        adj[e.source().id()].push(e.target().id());
        inDeg[e.target().id()]++;
      });

      const durations = {};
      nodes.forEach(n => {
        durations[n.id()] = 1;
      });

      const topo = [];
      const queue = [];

      for (let id in inDeg) {
        if (inDeg[id] === 0) queue.push(id);
      }

      while (queue.length) {
        const u = queue.shift();
        topo.push(u);
        for (let v of adj[u]) {
          inDeg[v]--;
          if (inDeg[v] === 0) queue.push(v);
        }
      }

      const dist = {};
      nodes.forEach(n => dist[n.id()] = -Infinity);
      topo.forEach(n => {
        if (cy.incomers('#' + n).length === 0) dist[n] = 0;
      });

      for (let u of topo) {
        for (let v of adj[u]) {
          if (dist[v] < dist[u] + durations[u]) {
            dist[v] = dist[u] + durations[u];
          }
        }
      }

      let maxDist = -1, lastNode = null;
      for (let id in dist) {
        if (dist[id] > maxDist) {
          maxDist = dist[id];
          lastNode = id;
        }
      }

      const path = [lastNode];
      while (true) {
        const preds = cy.predecessors('#' + lastNode).nodes();
        let found = false;
        for (let p of preds) {
          if (dist[lastNode] === dist[p.id()] + durations[p.id()]) {
            path.unshift(p.id());
            lastNode = p.id();
            found = true;
            break;
          }
        }
        if (!found) break;
      }

      for (let i = 0; i < path.length - 1; i++) {
        const edge = cy.getElementById(path[i] + path[i + 1]);
        const edgeAlt = cy.edges().filter(e => e.source().id() === path[i] && e.target().id() === path[i + 1]);
        if (edgeAlt.length) edgeAlt.addClass('critical');
      }

      document.getElementById('info').innerText = "Critical Path: " + path.join(" ‚Üí ");
    }
  </script>
</body>
</html>
